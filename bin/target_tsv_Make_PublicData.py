#!/usr/bin/env python

import sys
import pandas as pd 
import os 
import argparse
import requests
import re

def replace_special_characters(input_string):
    # Define a regex pattern to match special characters
    pattern = r'[^a-zA-Z0-9\-\+]'  # Match any character that is not a letter, digit, "-", or "+"
    
    # Replace special characters with "_"
    result = re.sub(pattern, '_', input_string)
    
    # Replace "+" with "_pos_"
    result = result.replace('+', '_pos_')
    
    # Convert the result to lowercase
    result = "s_" + result.lower()
    
    return result

parser = argparse.ArgumentParser()
# parser.add_argument('-s', '--sample_report', default=None, help= "Input Samplereport.csv associated to order, generated by primary analysis pipeline")
parser.add_argument('-o', '--output_dir', default="./", help="Output directory, default=cwd, default='./'")
parser.add_argument('-s','--samplesheet')
args=parser.parse_args()

df_sample_info = pd.read_csv(args.samplesheet, sep="\t") 

order_list = df_sample_info["molngID"].to_list()
sampleName = df_sample_info["samplename"].to_list()
secundoName = df_sample_info["secundoname"].to_list()
flowCell =  df_sample_info["molngID"].to_list()
libraryID = df_sample_info["libID"]
laneID = df_sample_info["libID"]
bardcodes = ["NA"] * len(df_sample_info) # This is to consider the situations where two indexes are available

df_target_tsv = pd.DataFrame()
df_target_tsv["Order"] = order_list
df_target_tsv["Sample Name"] = sampleName
df_target_tsv["Secundo Name"] = secundoName
df_target_tsv["Flowcell"] = flowCell
df_target_tsv["Library"] = libraryID
df_target_tsv["Lane"] = laneID
df_target_tsv["Barcode"] = bardcodes

df_target_tsv.to_csv("targets.tsv",sep="\t",index=False)
